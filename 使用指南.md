# ExcelCompare 使用指南

## 完整操作步骤

### 第一步：安装依赖

```bash
pip install -r requirements.txt
```

### 第二步：生成100个Excel文件

```bash
python generate_excels.py
```

执行后会在 `excels` 目录下生成100个Excel文件，每个文件包含：
- 1个"修改记录"sheet页
- 3个数据表sheet页

### 第三步：初始化Git仓库

```bash
git init
```

### 第四步：安装Git钩子

```bash
python install_hooks.py
```

这会安装pre-commit钩子，在每次提交前自动检查Excel文件。

### 第五步：提交到GitHub

```bash
git add .
git commit -m "初始化Excel文件"
git branch -M main
git remote add origin https://github.com/edwardwonggang/ExcelCompare.git
git push -u origin main
```

### 第六步：测试检查功能

#### 场景1：修改Excel文件但未添加修订记录

1. 修改某个Excel文件（例如：`excels/数据文件_001.xlsx`）
2. 不要修改"修改记录"sheet页
3. 尝试提交：

```bash
git add excels/数据文件_001.xlsx
git commit -m "修改数据文件"
```

**预期结果**：提交被拦截，提示"修改记录sheet页为空，请添加修订记录后再提交"

#### 场景2：修改Excel文件并添加修订记录

1. 修改某个Excel文件
2. 在"修改记录"sheet页添加新的修订记录
3. 提交：

```bash
git add excels/数据文件_001.xlsx
git commit -m "修改数据文件并添加修订记录"
```

**预期结果**：检查通过，提交成功

#### 场景3：批量修改多个Excel文件

1. 修改多个Excel文件
2. 为每个文件添加修订记录
3. 批量提交：

```bash
git add excels/*.xlsx
git commit -m "批量更新Excel文件"
```

**预期结果**：使用多线程并行检查，快速完成100个文件的检查

## 手动检查命令

### 检查所有Excel文件

```bash
python excel_checker.py --all
```

### 检查指定文件

```bash
python excel_checker.py --files excels/数据文件_001.xlsx excels/数据文件_002.xlsx
```

## 性能优化说明

### 多线程检查

- 默认使用10个线程并行检查
- 可在 `config.json` 中调整 `max_threads` 参数
- 100个文件预计在5-10秒内完成检查

### 缓存机制

- 使用 `.excel_cache.json` 缓存文件哈希值
- 未修改的文件会跳过检查
- 大幅提升重复提交时的检查速度

## 常见问题

### Q1: 提交时提示"无法获取暂存区文件"

**原因**：不在Git仓库中或Git命令执行失败

**解决**：确保已执行 `git init` 并且在Git仓库目录下

### Q2: 检查速度很慢

**解决**：
1. 增加 `config.json` 中的 `max_threads` 值
2. 确保使用SSD硬盘
3. 关闭杀毒软件对Excel文件的实时扫描

### Q3: 如何禁用检查

**方法1**：删除钩子文件
```bash
rm .git/hooks/pre-commit
```

**方法2**：使用 `--no-verify` 参数跳过检查
```bash
git commit --no-verify -m "提交信息"
```

### Q4: 修改记录sheet页的格式要求

**必须包含的列**：
- 修订人
- 修订时间
- 修订内容

**可选列**：
- 修订版本

**注意事项**：
- 第一行必须是表头
- 从第二行开始是数据
- 至少需要一条修订记录

## 卸载方法

```bash
# 删除钩子
rm .git/hooks/pre-commit

# 删除缓存
rm .excel_cache.json
```
